@model NHS.Common.clsFeedBackModel
@{
    ViewBag.Title = "Positive Feedback";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<br />
<br />
<div class="container">
    <div class="row form-group">
        <div class="col-xs-12 col-lg-12">
            <div class="row" align="right">
                <div class="col-md-12">
                    <input type="image" src="~/images/Delete.png" width="30" height="30" alt="Submit" id="btnClose6" title="Close" />
                </div>
            </div>
            <ul class="nav nav-pills nav-justified thumbnail setup-panel">
                <li class="disabled">
                    <a href='@Url.Action("PatientDetails", "home", new { id=Model.Patient_ID })'>
                        <h4 class="list-group-item-heading">
                            Patient details
                        </h4>
                    </a>

                </li>
                <li class="disabled">
                    <a href='@Url.Action("MedicalExaminerReview", "home", new { id=Model.Patient_ID })'>
                        <h4 class="list-group-item-heading">
                            Medical Examiner Scrutiny
                        </h4>
                    </a>
                </li>
                <li class="disabled">
                    <a href='@Url.Action("MedicalExaminerDecision", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            Medical Examiner Decision
                        </h4>
                    </a>
                </li>
                <li class="disabled">
                    <a href='@Url.Action("FinalOutcome", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            Final Outcome
                        </h4>
                    </a>
                </li>
                <li class="disabled">
                    <a href='@Url.Action("SJRAssessmentTriage", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            SJR Assessment Triage
                        </h4>
                    </a>
                </li>
                <li class="disabled">
                    <a href='@Url.Action("OtherReferrals", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            Other Referrals
                        </h4>
                    </a>
                </li>
                <li class="active">
                    <a href='@Url.Action("PositiveFeedback", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            Positive Feedback
                        </h4>
                    </a>
                </li>
                <li class="disabled">
                    <a href='@Url.Action("Declaration", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            Declaration
                        </h4>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="row setup-content" id="step-6">
        <div class="col-xs-12 col-lg-12">
            @using (Html.BeginForm("PositiveFeedback", "Home", FormMethod.Post, new { @id = Model.Patient_ID }))
            {
                <div class="col-md-12 well">
                    <div class="form-section">
                        <div class="lable_title">
                            <h2>POSITIVE FEEDBACK</h2>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="row_bar checkbox-row">
                                    @if (Model.MedTriage == 3)
                                    {
                                        if (Model.FormCompleted == true)
                                        {
                                            <input type="checkbox" disabled="disabled" id="FormCompleted" checked name="FormCompleted"><span> Above & Beyond form completed   </span>
                                        }
                                        else
                                        {
                                            <input type="checkbox" disabled="disabled" id="FormCompleted" name="FormCompleted"><span> Above & Beyond form completed  </span>
                                        }
                                    }
                                    else
                                    {
                                        if (Model.FormCompleted == true)
                                        {
                                            <input type="checkbox" id="FormCompleted" checked name="FormCompleted"><span> Above & Beyond form completed   </span>
                                        }
                                        else
                                        {
                                            <input type="checkbox" id="FormCompleted" name="FormCompleted"><span> Above & Beyond form completed  </span>
                                        }
                                    }
                                    <br />
                                    @if (Model.MedTriage == 3)
                                    {
                                        if (Model.ComplementsFedBack == true)
                                        {
                                            <input type="checkbox" disabled="disabled" id="ComplementsFedBack" checked name="ComplementsFedBack"><span> Compliments fed back to clinical team    </span>
                                        }
                                        else
                                        {
                                            <input type="checkbox" disabled="disabled" id="ComplementsFedBack" name="ComplementsFedBack"><span> Compliments fed back to clinical team   </span>
                                        }
                                    }
                                    else
                                    {
                                        if (Model.ComplementsFedBack == true)
                                        {
                                            <input type="checkbox" id="ComplementsFedBack" checked name="ComplementsFedBack"><span> Compliments fed back to clinical team    </span>
                                        }
                                        else
                                        {
                                            <input type="checkbox" id="ComplementsFedBack" name="ComplementsFedBack"><span> Compliments fed back to clinical team   </span>
                                        }
                                    }
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div style="z-index: 99;max-width: 75% !important;">
                                    @{
                                        var countcomments = @ViewBag.Feedback.lstFBComments.Count;
                                    }
                                    Available Feedbacks (<span id="com" name="0" value="0" onclick="OpenFilterComment(0)" style="cursor:pointer;">@countcomments</span>)
                                    <div class="clearfix" style="height:5px"></div>

                                    <table style="border-collapse:separate;border:solid black 1px;border-radius:6px; -moz-border-radius:6px; border-color:#a9d7cc;width:90%">

                                        @foreach (var item in ViewBag.FeedbackType)
                                        {

                                            var count = 0;

                                            <tr style="border-collapse:separate;border:solid black 1px;border-radius:6px; -moz-border-radius:6px; border-color:#a9d7cc">
                                                <td style="border-left:solid black 1px; border-top:solid black 1px; border-color:#a9d7cc; width:80%">
                                                    <span value="@item.FeedbackTypeID">@item.FBType</span>
                                                </td>
                                                @for (var i = 0; i < ViewBag.Feedback.lstFBComments.Count; i++)
                                                {
                                                    if (ViewBag.Feedback.lstFBComments[i].FBTypeID == item.FeedbackTypeID)
                                                    {
                                                        count++;
                                                        @*<span value="@item.CommonTypeID">@item.Type</span><br />*@
                                                    }
                                                }
                                                <td style="border-left:solid black 1px; border-top:solid black 1px; border-color:#a9d7cc; width:20%;text-align: -webkit-center;cursor:pointer;">
                                                    <span id="com" name="@item.FeedbackTypeID" value="@item.FeedbackTypeID" onclick="OpenFilterComment(@item.FeedbackTypeID)">@count</span>
                                                    @{

                                                        TempData["TypeIdFilter"] = @item.FeedbackTypeID;
                                                    }
                                                </td>
                                            </tr>
                                        }
                                        @*</tr>*@
                                    </table>

                                </div>
                            </div>

                            <div class="col-md-12">
                                Feedbacks @*<a href="#" id="commentslink" name="commentslink">View Previous Comments (@Model.CommentCount.ToString())</a>*@

                                <table class="table table-bordered" id="assets-data-table">
                                    @*<tr bgcolor="#a9d7cc" style="color:black;">
                                            <th style="text-align:center">Comments</th>
                                        </tr>*@
                                    <tbody bgcolor="#ffffff" style="color:black;">
                                        @for (var i = 0; i < ViewBag.Feedback.lstFBComments.Count; i++)
                                        {

                                            if (i == 0)
                                            {
                                                <tr style="color:black;" bgcolor="ffffff">
                                                    <td>
                                                        @*@if (Convert.ToInt32(ViewBag.Feedback.lstFBComments[i].CreatedTime.Substring(0, 2)) >= 12)
                                                            {*@
                                                        <div class="pull-left col-md-6" style="padding-left:0px">
                                                            <b>By:</b> @ViewBag.Feedback.lstFBComments[i].Name
                                                        </div>
                                                        <div class="pull-left col-md-6">
                                                            <b>Role:</b>  @ViewBag.Feedback.lstFBComments[i].Role
                                                        </div>
                                                        <div class="pull-left col-md-6" style="padding-left:0px">
                                                            <b>Date:</b> @ViewBag.Feedback.lstFBComments[i].CreatedDate.Date.ToString("dd/MM/yyyy")
                                                        </div>
                                                        <div class="pull-left col-md-6">
                                                            <b>Time:</b>


                                                            @if (Convert.ToInt32(ViewBag.Feedback.lstFBComments[i].CreatedTime.Split(':')[0]) >= 12)
                                                            {
                                                                @ViewBag.Feedback.lstFBComments[i].CreatedTime <b>PM</b>
                                                            }
                                                            else
                                                            {
                                                                @ViewBag.Feedback.lstFBComments[i].CreatedTime <b>AM</b>
                                                                                                }
                                                        </div>

                                                       
                                                        @*<div class="pull-left col-md-6">
                                                                    <b>Time:</b>
                                                                    @ViewBag.Feedback.lstFBComments[i].CreatedDate.TimeOfDay.Hours:@ViewBag.Feedback.lstFBComments[i].CreatedDate.TimeOfDay.Minutes:@ViewBag.Feedback.lstFBComments[i].CreatedDate.TimeOfDay.Seconds
                                                            @{
                                                                //var nowDate = new DateTime(Convert.ToInt32(@ViewBag.Feedback.lstFBComments[i].CreatedDate.slice(6)));
                                                                var date = new DateTime(@ViewBag.Feedback.lstFBComments[i].CreatedDate).ToShortDateString();
                                                            }
                                                            </div>*@

                                                        <div class="pull-left col-md-12" style="padding-left:0px">
                                                            <b>Feedback Type:</b> @ViewBag.Feedback.lstFBComments[i].FBType
                                                        </div>
                                                        <div class="pull-left col-md-12" style="padding-left:0px">
                                                            <b>Feedback:</b> @ViewBag.Feedback.lstFBComments[i].Comments
                                                        </div>

                                                        @*//}*@

                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>

                            <div id="comment" style="display:none;" class="col-md-12">
                                @*newly added for role and comment type*@
                                <div class="row">
                                    <div class="col-md-12" style="padding: 0 !important;">
                                        <div class="col-md-6">
                                            @*<div class="row_bar">*@
                                            Role
                                        </div>
                                        <div class="col-md-6">
                                            @{
                                                var role = TempData["Role"];
                                            }
                                            @Html.TextBox("role", role.ToString(), new { @readonly = "readonly", @class = "form-control", style = "width: 50%;cursor:not-allowed" })
                                            @*</div>*@
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12" style="padding: 0 !important;">
                                        <div class="col-md-6" style="padding: 0 !important;">
                                            <div class="col-md-6">
                                                Feedback Type
                                            </div>
                                            <div class="col-md-6">
                                                <select class="form-control" id="ddlFeedbackType" name="ddlFeedbackType">
                                                    <option value="">Select Feedback Type</option>
                                                    @foreach (var item in ViewBag.FeedbackType)
                                                    {
                                                        <option value="@item.FeedbackTypeID">@item.FBType</option>
                                                    }
                                                </select>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                                @*newly added*@
                                @*@Html.TextAreaFor(model => model.Comments, 10, 100, new { @class = "form-control" })*@
                                <div class="row_bar">
                                    Feedback
                                    @Html.TextAreaFor(model => model.Comments, 10, 100, new { @class = "form-control" })
                                    @*@Html.ValidationMessageFor(model => model.objclsMedicalExaminerReview.Comments, "", new { @class = "text-danger" })*@
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="pull-right">
                                    <button id="BtnOpenComment" name="BtnOpenComment" class="btn btn-primary" onclick="OpenComment(); return false;">Add Feedback</button>
                                </div>
                                <div class="pull-right">
                                    <button id="BtnCloseComment" name="BtnCloseComment" class="btn btn-primary" style="display:none;" onclick="CloseComment(); return false;">Close Feedback</button>
                                </div>
                            </div>
                            @*<div class="col-md-12">
                                    <div class="row_bar checkbox-row">

                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div class="row_bar">
                                        Comments
                                        @if (Model.MedTriage == 3)
                                        {
                                            @Html.TextAreaFor(model => model.Comments, 10, 100, new { @class = "form-control", @readonly = true })
                                            @Html.ValidationMessageFor(model => model.objclsMedicalExaminerReview.Comments, "", new { @class = "text-danger" })
                                            }
                                            else
                                            {
                                            @Html.TextAreaFor(model => model.Comments, 10, 100, new { @class = "form-control" })
                                            }
                                        </div>
                                    </div>
                                </div>*@
                        </div>
                    </div>
                    <div class="pull-right">
                        <button id="activate-prev-1" name="BtnPrevious" class="btn btn-primary btn-lg">Previous</button>
                        <button id="activate-step-2" type="submit" name="BtnFinish" class="btn btn-primary btn-lg">Save & Next</button>
                    </div>

                </div>

            }
        </div>
    </div>
    <br />
    <br />
    @*<div class="pull-right">
            <button class="btn btn-primary btn-lg" id="btnClose6">Close</button>
            </div>
        </div>*@
    <div class="modal fade" id="modelClose6">
        <div class="modal-dialog modal-md">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Message</h4>
                    <button type="button" class="close" data-dismiss="modal">×</button>
                </div>

                <!-- Modal body -->
                <div class="modal-body">
                    <div class="form-section" style="text-align:left">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="row_bar">
                                    <div>Do you want to exit without saving your changes?</div>
                                </div>
                            </div>
                            <br />
                            <br />
                            <div class="col-md-4">
                                <button type="button" class="btn btn-primary btn-block" id="btnModelClose1" data-dismiss="modal" formmethod="post" onclick="location.href='@Url.Action("MortalityReview", "Home", new { id=Model.Patient_ID })'">Yes</button>
                            </div>
                            <div class="col-md-4">
                                <button type="submit" class="btn btn-primary btn-block" name="btnCloseYes" id="btnCloseYes">No</button>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @*changes for showing filter comments based on comment type*@
    <div class="modal fade" id="myModalCommentsFilter" style="max-height:750px; overflow:auto">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Feedback History</h4>
                    <button type="button" class="close" data-dismiss="modal">×</button>
                </div>
                <!-- Modal body -->
                <div class="modal-body">
                    <table class="table table-bordered" id="FilterComment">
                        <tr bgcolor="#a9d7cc" style="color:black;">
                            <th style="text-align:center">Feedback</th>
                        </tr>

                    </table>
                </div>
            </div>
        </div>
    </div>
    @*end changes*@


    <script>
        $(document).ready(function () {
            $("#btnClose6").click(function () {
                $("#modelClose6").modal();
            });
        });
    </script>
    <script type="text/javascript">
$(function () {
    $("#btnModelClose6").click(function () {
window.location.href = "@Url.Action("MortalityReview", "Home", new { id = Model.Patient_ID }))";
});
});
    </script>
    <script>
        $(document).ready(function () {
            $("#btnCloseYes").click(function () {
                $("#modelClose6").modal('hide');
            });
        });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-dateFormat/1.0/jquery.dateFormat.js"></script>
    <script>
    function OpenComment() {
        $("#comment").show();
        $("#BtnOpenComment").hide();
        $("#BtnCloseComment").show();
        return false;
    }
    function CloseComment() {
        $("#comment").hide();
        $("#BtnOpenComment").show();
        $("#BtnCloseComment").hide();
        return false;
    }
    function OpenFilterComment(e) {
        debugger;
        var tableF = document.getElementById("FilterComment");
        tableF.innerHTML = "";
        tableF.innerHTML = "<tr bgcolor='#a9d7cc' style='color:black;'><th style='text-align:center'>Feedback</th></tr>";
        var data = @Html.Raw(Json.Encode(@ViewBag.Feedback.lstFBComments));
        var newElement = document.createElement("tr");
        for (var i = 0; i < @ViewBag.Feedback.lstFBComments.Count; i++)
        {
            var typeIDFilter = e;
            var newElement = document.createElement("tr");
            if (typeIDFilter != null)
            {
                if (data[i].FBTypeID == parseInt(typeIDFilter))
                {

                    var nowDate = new Date(parseInt(data[i].CreatedDate.substr(6)));
                    //var result = "";
                    //result += nowDate.format("ddd mmm dd yyyy HH:MM:ss");
                    if (parseInt(data[i].CreatedTime.slice(0, 2)) >= 12)
                    {
                        var div = ("<tr style = 'color:black; bgcolor = ffffff>" +
                            "<td>" +
                            //"<div style = 'text-align:left' >" +
                            "<div class='col-md-6'><b>By: </b>" + data[i].Name + "</div>" +
                            "<div class='pull-right col-md-6'><b>Role: </b>" + data[i].Role + "</div>" +
                            "<div class='pull-left col-md-6' style='padding-left:0px'><b>Date: </b>" + nowDate.toLocaleDateString() + "</div>" +
                            "<div class='pull-right col-md-6'><b>Time: </b>" + data[i].CreatedTime + " PM</div>" + /*nowDate.toLocaleTimeString()*/
                            "<div class='pull-left col-md-12' style='padding-left:0px'><b>Feedback Type:</b> " + data[i].FBType + "</div>" +
                            "<div class='pull-left col-md-12' style='padding-left:0px'><b>Feedback: </b>" + data[i].Comments + "</div>" +
                            "</td>" +
                            "</tr>");
                    }
                    else
                    {
                        var div = ("<tr style = 'color:black; bgcolor = ffffff>" +
                            "<td>" +
                            //"<div style = 'text-align:left' >" +
                            "<div class='col-md-6'><b>By: </b>" + data[i].Name + "</div>" +
                            "<div class='pull-right col-md-6'><b>Role: </b>" + data[i].Role + "</div>" +
                            "<div class='pull-left col-md-6' style='padding-left:0px'><b>Date: </b>" + nowDate.toLocaleDateString() + "</div>" +
                            "<div class='pull-right col-md-6'><b>Time: </b>" + data[i].CreatedTime + " AM</div>" + /*nowDate.toLocaleTimeString()*/
                            "<div class='pull-left col-md-12' style='padding-left:0px'><b>Feedback Type:</b> " + data[i].FBType + "</div>" +
                            "<div class='pull-left col-md-12' style='padding-left:0px'><b>Feedback: </b>" + data[i].Comments + "</div>" +
                            "</td>" +
                            "</tr>");
                    }
                       

                      
                    newElement.innerHTML = div;

                    newElement.style.color = "black";
                    newElement.style.bgcolor = "ffffff";
                    newElement.style.border = "1px solid #dee2e6";

                    tableF.appendChild(newElement);
                    }

                }
                else if (parseInt(typeIDFilter) == 0)
                {
                    if (parseInt(data[i].CreatedTime.slice(0, 2)) >= 12)
                    {
                        var div = ("<tr style = 'color:black; bgcolor = ffffff>" +
                            "<td>" +
                            //"<div style = 'text-align:left' >" +
                            "<div class='col-md-6'><b>By: </b>" + data[i].Name + "</div>" +
                            "<div class='pull-right col-md-6'><b>Role: </b>" + data[i].Role + "</div>" +
                            "<div class='pull-left col-md-6' style='padding-left:0px'><b>Date: </b>" + data[i].CreatedDate + "</div>" +
                            "<div class='pull-right col-md-6'><b>Time: </b>" + data[i].CreatedTime + " PM</div>" +
                            "<div class='pull-left col-md-12' style='padding-left:0px'><b>Feedback Type:</b> " + data[i].CommentType + "</div>" +
                            "<div class='pull-left col-md-12' style='padding-left:0px'><b>Feedback: </b>" + data[i].Comments + "</div>" +
                            "</td>" +
                            "</tr>");
                    }
                    else
                    {
                        var div = ("<tr style = 'color:black; bgcolor = ffffff>" +
                            "<td>" +
                            //"<div style = 'text-align:left' >" +
                            "<div class='col-md-6'><b>By: </b>" + data[i].Name + "</div>" +
                            "<div class='pull-right col-md-6'><b>Role: </b>" + data[i].Role + "</div>" +
                            "<div class='pull-left col-md-6' style='padding-left:0px'><b>Date: </b>" + data[i].CreatedDate + "</div>" +
                            "<div class='pull-right col-md-6'><b>Time: </b>" + data[i].CreatedTime + " AM</div>" +
                            "<div class='pull-left col-md-12' style='padding-left:0px'><b>Feedback Type:</b> " + data[i].CommentType + "</div>" +
                            "<div class='pull-left col-md-12' style='padding-left:0px'><b>Feedback: </b>" + data[i].Comments + "</div>" +
                            "</td>" +
                            "</tr>");
                    }
                    newElement.innerHTML = div;

                    newElement.style.color = "black";
                    newElement.style.bgcolor = "ffffff";
                    newElement.style.border = "1px solid #dee2e6";

                    tableF.appendChild(newElement);
                }
            }

        //tableF.innerHTML = a.toString() + "</tbody>";
        //alert(tableF.innerHTML);
        $("#myModalCommentsFilter").modal();
    }
    </script>
