@model NHS.Common.clsMedicalExaminerReview
@{
    ViewBag.Title = "Medical Examiner Review";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    table, th, td {
        border: 1px solid black;
    }

    table {
        width: -webkit-fill-available;
    }

    #com:hover {
        color: blue;
        text-decoration: underline;
    }
</style>
<br />
<br /><br />
<div class="container">
    <div class="row form-group">
        <div class="col-xs-12 col-lg-12">
            <div class="row" align="right">
                <div class="col-md-12">
                    <input type="image" src="~/images/Delete.png" width="30" height="30" alt="Submit" id="btnClose2" title="Close" />
                </div>
            </div>
            <ul class="nav nav-pills nav-justified thumbnail setup-panel">
                <li class="disabled">
                    <a href='@Url.Action("PatientDetails", "home", new { id=Model.Patient_ID })'>
                        <h4 class="list-group-item-heading">
                            Patient details
                        </h4>
                    </a>

                </li>
                <li class="active">
                    <a href='@Url.Action("MedicalExaminerReview", "home", new { id=Model.Patient_ID })'>
                        <h4 class="list-group-item-heading">
                            Medical Examiner Scrutiny
                        </h4>
                    </a>
                </li>

                <li class="disabled">
                    <a href='@Url.Action("MedicalExaminerDecision", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            Medical Examiner Decision
                        </h4>
                    </a>
                </li>
                <li class="disabled">
                    <a href='@Url.Action("SJRAssessmentTriage", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            SJR Assessment Triage
                        </h4>
                    </a>
                </li>
                <li class="disabled">
                    <a href='@Url.Action("OtherReferrals", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            Other Referrals
                        </h4>
                    </a>
                </li>
                <li class="disabled">
                    <a href='@Url.Action("PositiveFeedback", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            Positive Feedback
                        </h4>
                    </a>
                </li>
                <li class="disabled">
                    <a href='@Url.Action("MeDeclaration", "home", new { id = Model.Patient_ID})'>
                        <h4 class="list-group-item-heading">
                            ME Declaration
                        </h4>
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <div class="row setup-content" id="step-2">
        <div class="col-xs-12 col-lg-12">
            @using (Html.BeginForm("MedicalExaminerReview", "Home", FormMethod.Post, new { @id = Model.Patient_ID }))
            {
                <div class="col-md-12 well">
                    @*<div class="form-section">*@
                    <div class="lable_title">
                        <h2>MEDICAL EXAMINER REVIEW </h2>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="row_bar">
                                Name of Medical Examiner
                                <select class="form-control" id="ddlDischargeSpeciality" name="ddlDischargeSpeciality">
                                    <option value="">
                                        Select Medical Examiner
                                    </option>
                                    @foreach (var item in ViewBag.MedicalExaminers)
                                    {
                                        if (item.ID == Model.ME_ID)
                                        {
                                            <option selected value="@item.ID">@item.Name</option>
                                        }
                                        else
                                        {
                                            <option value="@item.ID">@item.Name</option>
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6" style="padding-left: 64px;float: right;position: absolute;top: 24px;right: -68px;z-index: 9999;">
                            @{
                                var countcomments = @Model.CommentCount.ToString();
                            }
                            Available Comments (@countcomments)
                            <div class="clearfix" style="height:5px"></div>
                            <div class="row">
                                <div class="col-md-6">
                                    <table>


                                        @foreach (var item in ViewBag.CommentType)
                                        {

                                            var count = 0;

                                            <tr>
                                                <td style="padding-left: 17px !important;">
                                                    <span value="@item.CommonTypeID">@item.Type</span>
                                                </td>

                                                @for (var i = 0; i < ViewBag.Comments.Count; i++)
                                                {
                                                    if (ViewBag.Comments[i].CommentTypeID == item.CommonTypeID)
                                                    {
                                                        count++;
                                                        @*<span value="@item.CommonTypeID">@item.Type</span><br />*@
                                                    }
                                                }
                                                <td style="text-align: -webkit-center;cursor:pointer;">
                                                    <span id="com" name="@item.CommonTypeID" value="@item.CommonTypeID" onclick="OpenFilterComment(@item.CommonTypeID)">@count</span>
                                                    @{

                                                        TempData["TypeIdFilter"] = @item.CommonTypeID;
                                                    }
                                                </td>
                                            </tr>
                                        }
                                        @*</tr>*@
                                    </table>
                                </div>
                                <div class="col-md-6">
                                    @*@foreach (var item in ViewBag.CommentType)
                                        {
                                            <span value="@item.CommonTypeID">@item.Type</span><br />
                                        }*@
                                </div>
                            </div>
                            @*<table>
                                    <tbody>
                                        <tr>
                                            <td>Next of Kin</td>
                                            <td>1</td>
                                        </tr>
                                        <tr>
                                            <td>Clinical Documents</td>
                                            <td>2</td>
                                        </tr>
                                        <tr>
                                            <td>others</td>
                                            <td>3</td>

                                        </tr>
                                    </tbody>
                                </table>*@
                        </div>
                        <div class="col-md-12">
                            <div class="row_bar">
                                Name of QAP
                                @{
                                    var fname = Session["FullName"];
                                    var QAPName = Session["QAPName"];
                                }
                                @if (QAPName != null)
                                {
                                    @Html.Label("lblQAP", QAPName.ToString(), new { style = "width:40%; margin: 9px;" })
                                }
                                else
                                {
                                    @Html.Label("lblQAP", fname.ToString(), new { style = "width:40%; margin: 9px;" })
                                }

                                @*@Html.EditorFor(model => model.QAPName, new { htmlAttributes = new { @class = "form-control" } })
                                    @Html.ValidationMessageFor(model => model.objclsMedicalExaminerReview.QAPName, "", new { @class = "text-danger" })*@

                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="row_bar checkbox-row">
                                @if (Model.QAP_Discussion == true)
                                {
                                    <input type="checkbox" id="QAP_Discussion" checked name="QAP_Discussion"><span> Discussion with QAP Complete? </span>
                                }
                                else
                                {
                                    <input type="checkbox" id="QAP_Discussion" name="QAP_Discussion"><span> Issue MCCD </span>
                                }
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="row_bar checkbox-row">
                                @if (Model.Notes_Review == true)
                                {
                                    <input type="checkbox" id="Notes_Review" checked name="Notes_Review"><span> Notes review complete? </span>
                                }
                                else
                                {
                                    <input type="checkbox" id="Notes_Review" name="Notes_Review"><span> Notes review complete? </span>
                                }
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="row_bar checkbox-row mb-3">
                                @if (Model.Nok_Discussion == true)
                                {
                                    <input type="checkbox" id="Nok_Discussion" checked name="Nok_Discussion"><span> Discussion with NoK complete? </span>
                                }
                                else
                                {
                                    <input type="checkbox" id="Nok_Discussion" name="Nok_Discussion"><span> Discussion with NoK complete? </span>
                                }

                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="row_bar">
                               Latest Comment @*<a href="#" id="commentslink" name="commentslink">View Previous Comments (@Model.CommentCount.ToString())</a>*@

                                <table class="table table-bordered" id="assets-data-table">
                                    @*<tr bgcolor="#a9d7cc" style="color:black;">
                                            <th style="text-align:center">Comments</th>
                                        </tr>*@
                                    <tbody bgcolor="#ffffff" style="color:black;">
                                        @for (var i = 0; i < ViewBag.Comments.Count; i++)
                                        {
                                            if (i == 0)
                                            {
                                                <tr style="color:black;" bgcolor="ffffff">
                                                    <td>
                                                        @if (Convert.ToInt32(ViewBag.Comments[i].CreatedTime.Substring(0, 2)) >= 12)
                                                        {
                                                        <div style="text-align:left">
                                                            By: @ViewBag.Comments[i].Name<br />
                                                            Date: @ViewBag.Comments[i].CreatedDate <br />
                                                            Time: @ViewBag.Comments[i].CreatedTime PM<br />
                                                            Comment: @ViewBag.Comments[i].Comments <br />
                                                            Role: @ViewBag.Comments[i].Role <br />
                                                        </div>
                                                        }
                                                        else
                                                        {
                                                        <div style="text-align:left">
                                                            By: @ViewBag.Comments[i].Name<br />
                                                            Date: @ViewBag.Comments[i].CreatedDate <br />
                                                            Time: @ViewBag.Comments[i].CreatedTime AM<br />
                                                            Comment: @ViewBag.Comments[i].Comments <br />
                                                            Role: @ViewBag.Comments[i].Role <br />
                                                        </div>
                                                        }
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>

                                <div id="comment" style="display:none;">
                                    @*newly added for role and comment type*@
                                    <div class="row">
                                        <div class="col-md-12" style="padding: 0 !important;">
                                            <div class="col-md-6">
                                                @*<div class="row_bar">*@
                                                Role
                                            </div>
                                            <div class="col-md-6">
                                                @{
                                                    var role = TempData["Role"];
                                                }
                                                @Html.TextBox("role", role.ToString(), new { @readonly = "readonly", @class = "form-control", style = "width: 50%;cursor:not-allowed" })

                                                @*</div>*@
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12" style="padding: 0 !important;">
                                            <div class="col-md-6" style="padding: 0 !important;">

                                                <div class="col-md-6">

                                                    Comment Type
                                                </div>
                                                <div class="col-md-6">
                                                    <select class="form-control" id="ddlCommentType" name="ddlCommentType">
                                                        <option value="">Select Comment Type</option>
                                                        @foreach (var item in ViewBag.CommentType)
                                                        {
                                                            <option value="@item.CommonTypeID">@item.Type</option>
                                                        }
                                                    </select>
                                                </div>



                                            </div>
                                        </div>
                                    </div>
                                    @*newly added*@

                                    @Html.TextAreaFor(model => model.Comments, 10, 100, new { @class = "form-control" })
                                </div>
                                <div class="pull-right">
                                    <button id="BtnOpenComment" name="BtnOpenComment" class="btn btn-primary btn-lg" onclick="OpenComment(); return false;">Add Comment</button>
                                </div>
                                <div class="pull-right">
                                    <button id="BtnCloseComment" name="BtnCloseComment" class="btn btn-primary btn-lg" style="display:none;" onclick="CloseComment(); return false;">Close Comment</button>
                                </div>
                                @*@Html.ValidationMessageFor(model => model.objclsMedicalExaminerReview.Comments, "", new { @class = "text-danger" })*@
                            </div>
                        </div>
                    </div>

                </div>
                <div class="pull-right">
                    <button id="BtnPrevious" name="BtnPrevious" class="btn btn-primary btn-lg">Previous</button>
                    <button id="BtnNext" name="BtnNext" class="btn btn-primary btn-lg">Save & Next</button>
                </div>
            }
        </div>
    </div>
    <br />
    <br />
</div>
<div class="modal fade" id="myModalComments">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Comments History</h4>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">

                <table class="table table-bordered" id="assets-data-table">
                    <tr bgcolor="#a9d7cc" style="color:black;">
                        <th style="text-align:center">Comments</th>
                    </tr>
                    <tbody bgcolor="#ffffff" style="color:black;">
                        @foreach (var item in ViewBag.Comments)
                        {
                            <tr style="color:black;" bgcolor="ffffff">
                                <td>
                                    @if (Convert.ToInt32(item.CreatedTime.Substring(0, 2)) >= 12)
                                    {
                                    <div style="text-align:left">
                                        By: @item.Name<br />
                                        Date: @item.CreatedDate <br />
                                        Time: @item.CreatedTime PM<br />
                                        Comment: @item.Comments <br />
                                        Role:  @item.Role <br />
                                    </div>
                                    }
                                    else
                                    {
                                    <div style="text-align:left">
                                        By: @item.Name<br />
                                        Date: @item.CreatedDate <br />
                                        Time: @item.CreatedTime AM<br />
                                        Comment: @item.Comments <br />
                                        Role:  @item.Role <br />
                                    </div>
                                    }
                                </td>
                            </tr>
                        }

                    </tbody>
                </table>

            </div>



            <!-- Modal footer -->
            @*<div class="modal-footer">
                    <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                </div>*@

        </div>
    </div>
</div>

@*changes for showing filter comments based on comment type*@

<div class="modal fade" id="myModalCommentsFilter">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Comments History</h4>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <table class="table table-bordered" id="">
                    <tr bgcolor="#a9d7cc" style="color:black;">
                        <th style="text-align:center">Comments</th>
                    </tr>
                </table>
                <table class="table table-bordered" id="FilterComment">
                   
                    <tbody bgcolor="#ffffff" style="color:black;">
                        @*@foreach (var item in ViewBag.Comments)
                            {
                                if (TempData["TypeIdFilter"] != null)
                                {

                                    if (item.CommentTypeID == Convert.ToInt32(TempData["TypeIdFilter"]))
                                    {
                                        <tr style="color:black;" bgcolor="ffffff">
                                            <td>
                                                @if (Convert.ToInt32(item.CreatedTime.Substring(0, 2)) >= 12)
                                                {
                                                    <div style="text-align:left">
                                                        By: @item.Name<br />
                                                        Date: @item.CreatedDate <br />
                                                        Time: @item.CreatedTime PM<br />
                                                        Comment: @item.Comments <br />
                                                    </div>
                                                }
                                                else
                                                {
                                                    <div style="text-align:left">
                                                        By: @item.Name<br />
                                                        Date: @item.CreatedDate <br />
                                                        Time: @item.CreatedTime AM<br />
                                                        Comment: @item.Comments <br />
                                                    </div>
                                                }
                                            </td>
                                        </tr>
                                    }
                                }
                            }*@

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
@*end changes*@
<div class="modal fade" id="modelClose2">
    <div class="modal-dialog modal-md">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Message</h4>
                <button type="button" class="close" data-dismiss="modal">×</button>
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <div class="form-section" style="text-align:left">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="row_bar">
                                <div>Do you want to exit without saving your changes?</div>
                            </div>
                        </div>
                        <br />
                        <br />
                        <div class="col-md-4">
                            <button type="button" class="btn btn-primary btn-block" id="btnModelClose1" data-dismiss="modal" formmethod="post" onclick="location.href='@Url.Action("MortalityReview", "Home", new { id=Model.Patient_ID })'">Yes</button>
                        </div>
                        <div class="col-md-4">
                            <button type="submit" class="btn btn-primary btn-block" name="btnCloseYes" id="btnCloseYes">No</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $("#btnClose2").click(function () {
            $("#modelClose2").modal();
        });


    });
    function OpenComment() {
        $("#comment").show();
        $("#BtnOpenComment").hide();
        $("#BtnCloseComment").show();
        return false;
    }
    function CloseComment() {
        $("#comment").hide();
        $("#BtnOpenComment").show();
        $("#BtnCloseComment").hide();
        return false;
    }
</script>
<script type="text/javascript">
$(function () {

     $("#btnModelClose2").click(function(){
window.location.href = "@Url.Action("MortalityReview", "Home", new { id = Model.Patient_ID }))";
    });

});
</script>
<script>
    $(document).ready(function () {
        $("#btnCloseYes").click(function () {
            $("#modelClose2").modal('hide');
        });
    });
</script>
<script>
    $(document).ready(function () {
        //$('#dvPatientDetailsCimment').hide();
        $("#commentslink").click(function () {
            $("#myModalComments").modal();
        });
    });
    function OpenFilterComment(e) {
        var tableF = document.getElementById("FilterComment");
        tableF.innerHTML = "";
          var data = @Html.Raw(Json.Encode(@ViewBag.Comments));
        for (var i = 0; i < @ViewBag.Comments.Count; i++) {
            var typeIDFilter = e;
            var newElement = document.createElement("tr");
            if (typeIDFilter != null) {


              
                if (data[i].CommentTypeID == parseInt(typeIDFilter)) {

                    if (parseInt(data[i].CreatedTime.slice(0, 2)) >= 12) {
                        var div = ("<tr style = 'color:black; bgcolor = ffffff>" +
                            "<td>" +
                            "<div style = 'text-align:left' >" +
                            "By:" + data[i].Name + "<br/>" +
                            "Date:" + data[i].CreatedDate + "<br/>" +
                            "Time:" + data[i].CreatedTime + "PM<br/>" +
                            "Comment:" + data[i].Comments + "<br/>" +
                            "Role:" + data[i].Role + "<br/>" +
                            "</div>" +
                            "</td>" +
                            "</tr>");
                    }
                    else {
                        var div = ("<tr style = 'color:black; bgcolor = ffffff>" +
                            "<td>" +
                            "<div style = 'text-align:left' >" +
                            "By:" + data[i].Name + "<br/>" +
                            "Date:" + data[i].CreatedDate + "<br/>" +
                            "Time:" + data[i].CreatedTime + "AM<br/>" +
                            "Comment:" + data[i].Comments + "<br/>" +
                            "Role:" + data[i].Role + "<br/>" +
                            "</div>" +
                            "</td>" +
                            "</tr>");
                    }
                     newElement.innerHTML = div;

                     newElement.style.color = "black";
                    newElement.style.bgcolor = "ffffff";
                    newElement.style.border = "1px solid #dee2e6";
                     
                     tableF.appendChild(newElement);


                 }
            }
        }
        $("#myModalCommentsFilter").modal();
}
</script>