@model List<NHS.Common.clsPatientDetails>
@using NHS.Models;
@{
    ViewBag.Title = "Medical Examiner Dashboard";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<br />
<br />
<!-- DataTables -->
<div class="col-sm-12" style="margin-left:12%;margin-top:-12%">
    <div class="row">
        <div class="col-md-12">
            <form action="@Url.Action("MedicalExaminerDashboard", "Home")" method="post">
                <div class="row">
                    <div class="col-md-12">
                        <div class="row">
                            <div style="width:150px;margin-left:12%; ">
                                <div class="row_bar">
                                    @if (ViewBag.StartDate != "1/1/1990")
                                    {
                                        <input class="form-control input_datepicker" type="text" id="txtStartDate" name="txtStartDate" placeholder="All Dates" value="@ViewBag.StartDate">
                                    }
                                    else
                                    {
                                        <input class="form-control input_datepicker" type="text" id="txtStartDate" name="txtStartDate" placeholder="All Dates" value="">
                                    }
                                </div>
                            </div>
                            <div style="width:150px; ">
                                <div class="row_bar">
                                    <input class="form-control input_datepicker" type="text" id="txtEndDate" name="txtEndDate" placeholder="All Dates" value="@ViewBag.EndDate">&nbsp;&nbsp;
                                </div>
                            </div>
                            <div class="col-md-2" style="width:200px; ">
                                <div class="row_bar">
                                    <select class="form-control" id="ddlDischargeSpeciality" name="ddlDischargeSpeciality">
                                        @if (ViewBag.Speciality == "0")
                                        {
                                            <option selected value="0">
                                                All Specialities
                                            </option>
                                        }
                                        else
                                        {
                                            <option value="0">
                                                All Specialities
                                            </option>
                                        }
                                        @foreach (var item in ViewBag.LoadDischargeSpecialityDropdown)
                                        {
                                            if (item.DischargeSpeciality == ViewBag.Speciality && ViewBag.Speciality != "0"
                                                && ViewBag.Speciality != "")
                                            {
                                                <option selected value="@item.DischargeSpeciality">@item.DischargeSpeciality</option>
                                            }
                                            else
                                            {
                                                <option value="@item.DischargeSpeciality">@item.DischargeSpeciality</option>
                                            }

                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2" style="width:200px;">
                                <div class="row_bar">
                                    <select class="form-control" id="ddlWardDeath" name="ddlWardDeath">
                                        @if (ViewBag.WardDeath == "0")
                                        {
                                            <option selected value="">
                                               All Wards
                                            </option>
                                        }
                                        else
                                        {
                                            <option value="0">
                                                All Wards
                                            </option>
                                        }
                                        @foreach (var item in ViewBag.wardDeathDropdown)
                                        {
                                            if (item.WardOfDeath == ViewBag.WardDeath && ViewBag.WardDeath != "0"
                                                && ViewBag.WardDeath != "")
                                            {
                                                <option selected value="@item.WardOfDeath">@item.WardOfDeath</option>
                                            }
                                            else
                                            {
                                                <option value="@item.WardOfDeath">@item.WardOfDeath</option>
                                            }
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2" style="width:200px;">
                                <div class="row_bar">
                                    <select class="form-control" id="ddlDischargeConsultant" name="ddlDischargeConsultant">
                                        @if (ViewBag.DischargeConsultant == "0")
                                        {
                                            <option selected value="">
                                                All Consultants
                                            </option>
                                        }
                                        else
                                        {
                                            <option value="0">
                                                All Consultants
                                            </option>
                                        }
                                        @foreach (var item in ViewBag.dischargeConsultantDropdown)
                                        {
                                            if (item.DischargeConsultantCode == ViewBag.DischargeConsultant && ViewBag.DischargeConsultant != "0"
                                                && ViewBag.DischargeConsultant != "")
                                            {
                                                <option selected value="@item.DischargeConsultantCode">@item.DischargeConsultantName</option>
                                            }
                                            else
                                            {
                                                <option value="@item.DischargeConsultantCode">@item.DischargeConsultantName</option>
                                            }
                                        }
                                    </select>
                                </div>
                            </div>
                            <div class="pull-right">
                                <div class="col-md-12">
                                    <button id="btnSearch" type="submit" class="btn btn-primary btn-md" name="btnSearch">Search </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <br />

        <div style="width:100%;margin-left:12% !important; overflow:auto;">
            <table class="stripe row-border order-column" style="" id="tblPatientDetails">
                <thead>
                    <tr bgcolor="#a9d7cc" style="color:black; font-size:11px;">
                        <th align="left" width="5%">Patient ID</th>
                        <th align="left" width="5%">Name</th>
                        <th align="left" width="5%">DOB</th>
                        <th align="center" width="3%">Date of Admission</th>
                        <th align="left" width="5%">Date of Death</th>
                        <th align="center" width="5%">Ward of Death</th>
                        <th align="center" width="5%">Discharge Consultant</th>
                        <th align="center" width="2%">Discharge Speciality</th>
                        @*<th align="center" width="5%">Admission Type</th>*@
                        <th align="center" width="2%">Medical Examiner Triage Review</th>
                        <th align="center" width="2%">SJR Review Status</th>
                        <th align="center" width="2%">SJR  Review Outcome</th>
                        <th align="center" width="2%">SJR 2 Review Status</th>
                        <th align="center" width="2%">Coding Review Status</th>
                    </tr>
                </thead>
                <tbody style="font-size:11px;padding:0px;">
                    @if (Model.Count > 0)
                    {
                        foreach (var item in Model)
                        {
                            <tr>
                                <td align="center" width="5%"><u>@Html.ActionLink(item.PatientId.Trim(), "MortalityReview", new { id = item.ID }, new { @style = "color:blue;" })</u></td>
                                <td align="left" width="5%">@item.PatientName.Trim()</td>
                                <td align="left" width="5%">@String.Format("{0:dd/MM/yy}", item.DOB).Trim()</td>
                        <td align="center" width="3%">@String.Format("{0:dd/MM/yy}", item.DateofAdmission).Trim()</td>
                        <td align="center" width="5%">
                            @String.Format("{0:dd/MM/yy}", item.DateofDeath).Trim()
                        </td>
                        <td align="center" width="5%">@item.WardofDeath.Trim()</td>
                        <td align="center" width="5%">@item.DischargeConsutantName.Trim()</td>
                        <td align="left" width="2%">@item.DischargeSpeciality.Trim()</td>
                        @*<td align="center" width="5%">@item.AdmissionType</td>*@
                        <td align="center" width="2%">
                            @if (item.MedTriage == 0)
                            {
                                <a href='@Url.Action("PatientDetails", "home", new { id = item.ID })'><img src="~/images/GeryImg.png" width="18" height="18" title="Click to open Medical Examiner Triage form"></a>
                            }
                            else if (item.MedTriage == 1)
                            {
                                <a href='@Url.Action("PatientDetails", "home", new { id = item.ID })'><img src="~/images/amber.png" width="18" height="18" title="Click to open Medical Examiner Triage form"></a>
                            }

                            else if (item.MedTriage == 2)
                            {
                                <a href='@Url.Action("PatientDetails", "home", new { id = item.ID })'><img src="~/images/RedC.png" width="18" height="18" title="Click to open Medical Examiner Triage form"></a>
                            }
                            else if (item.MedTriage == 3 && item.IsFullSJRRequired == true)
                            {
                                <a href='@Url.Action("PatientDetails", "home", new { id = item.ID })'><img src="~/images/GreenCircle.png" width="18" height="18" title="Click to open Medical Examiner Triage form"></a>
                            }
                            else
                            {
                                <a href='@Url.Action("PatientDetails", "home", new { id = item.ID })'><img src="~/images/RedC.png" width="18" height="18" title="Click to open Medical Examiner Triage form"></a>
                            }
                        </td>
                        <td align="center" width="2%">
                            @if (item.SJR1 == 0)
                            {
                                <a href='@Url.Action("Stage2SJRformFirstStep", "home", new { id = item.ID })'><img src="~/images/GeryImg.png" width="18" height="18" title="Click to open SJR Stage 1 form"></a>
                            }
                            else if (item.SJR1 == 1)
                            {
                                <a href='@Url.Action("Stage2SJRformFirstStep", "home", new { id = item.ID })'><img src="~/images/amber.png" width="18" height="18" title="Click to open SJR Stage 1 form"></a>
                            }

                            else if (item.SJR1 == 2)
                            {
                                <a href='@Url.Action("Stage2SJRformFirstStep", "home", new { id = item.ID })'><img src="~/images/RedC.png" width="18" height="18" title="Click to open SJR Stage 1 form"></a>
                            }

                            else if (item.SJR1 == 3)
                            {
                                <a href='@Url.Action("Stage2SJRformFirstStep", "home", new { id = item.ID })'><img src="~/images/GreenCircle.png" width="18" height="18" title="Click to open SJR Stage 1 form"></a>
                            }
                            else
                            {
                                <a href='@Url.Action("Stage2SJRformFirstStep", "home", new { id = item.ID })'><img src="~/images/GeryImg.png" width="18" height="18" title="Click to open SJR Stage 1 form"></a>
                            }
                        </td>
                        <td align="center" width="2%">
                            @if (item.SJROutcome == 0)
                            {
                                <a href='@Url.Action("SJROutcome", "home", new { id = item.ID })'><img src="~/images/GeryImg.png" width="18" height="18" title="Click to open SJR Outcome form"></a>
                            }
                            else if (item.SJROutcome == 1)
                            {
                                <a href='@Url.Action("SJROutcome", "home", new { id = item.ID })'><img src="~/images/amber.png" width="18" height="18" title="Click to open SJR Outcome form"></a>
                            }

                            else if (item.SJROutcome == 2)
                            {
                                <a href='@Url.Action("SJROutcome", "home", new { id = item.ID })'><img src="~/images/RedC.png" width="18" height="18" title="Click to open SJR Outcome form"></a>
                            }

                            else if (item.SJROutcome == 3)
                            {
                                <a href='@Url.Action("SJROutcome", "home", new { id = item.ID })'><img src="~/images/GreenCircle.png" width="18" height="18" title="Click to open SJR Outcome form"></a>
                            }
                            else
                            {
                                <a href='@Url.Action("SJROutcome", "home", new { id = item.ID })'><img src="~/images/GeryImg.png" width="18" height="18" title="Click to open SJR Outcome form"></a>
                            }
                        </td>
                        <td align="center" width="2%">
                            @if (item.SJR2 == 0)
                            {
                                <a href='@Url.Action("Stage3SJRFormFirstStep", "home", new { id = item.ID })'><img src="~/images/GeryImg.png" width="18" height="18" title="Click to open SJR Stage 2 form"></a>
                            }
                            else if (item.SJR2 == 1)
                            {
                                <a href='@Url.Action("Stage3SJRFormFirstStep", "home", new { id = item.ID })'><img src="~/images/amber.png" width="18" height="18" title="Click to open SJR Stage 2 form"></a>
                            }

                            else if (item.SJR2 == 2)
                            {
                                <a href='@Url.Action("Stage3SJRFormFirstStep", "home", new { id = item.ID })'><img src="~/images/RedC.png" width="18" height="18" title="Click to open SJR Stage 2 form"></a>
                            }

                            else if (item.SJR2 == 3)
                            {
                                <a href='@Url.Action("Stage3SJRFormFirstStep", "home", new { id = item.ID })'><img src="~/images/GreenCircle.png" width="18" height="18" title="Click to open SJR Stage 2 form"></a>
                            }
                            else
                            {
                                <a href='@Url.Action("Stage3SJRFormFirstStep", "home", new { id = item.ID })'><img src="~/images/GeryImg.png" width="18" height="18" title="Click to open SJR Stage 2 form"></a>
                            }
                        </td>
                        <td align="center" width="5%">
                            @if (item.MedTriage == 2)
                            {
                                <a href="@Url.Action("MortalityReview", "home", new { id = item.ID })"><img src="~/images/RedC.png" width="18" height="18"></a>
                            }
                            else if (item.MedTriage == 1)
                            {
                                <a href="@Url.Action("MortalityReview", "home", new { id = item.ID })"><img src="~/images/amber.png" width="18" height="18"></a>
                            }
                            else
                            {
                                if (item.IsFullSJRRequired == false)
                                {
                                    if (item.MedTriage == 3 && item.SJROutcome == 3)
                                    {
                                        <a href="@Url.Action("MortalityReview", "home", new { id = item.ID })"><img src="~/images/GreenCircle.png" width="18" height="18"></a>
                                    }
                                    else if (item.MedTriage == 3 && item.SJROutcome == 1)
                                    {
                                        <a href="@Url.Action("MortalityReview", "home", new { id = item.ID })"><img src="~/images/amber.png" width="18" height="18"></a>
                                    }
                                }
                                else
                                {
                                    if (item.MedTriage == 3 && item.SJROutcome == 1)
                                    {
                                        <a href="@Url.Action("MortalityReview", "home", new { id = item.ID })"><img src="~/images/amber.png" width="18" height="18"></a>
                                    }
                                    if (item.Stage2SJRRequired == false)
                                    {
                                        if (item.MedTriage == 3 && item.SJROutcome == 3 && item.SJR1 == 3)
                                        {
                                            <a href="@Url.Action("MortalityReview", "home", new { id = item.ID })"><img src="~/images/GreenCircle.png" width="18" height="18"></a>
                                        }
                                    }
                                    else
                                    {
                                        if (item.MedTriage == 3 && item.SJROutcome == 3 && item.SJR1 == 3 && item.SJR2 == 3)
                                        {
                                            <a href="@Url.Action("MortalityReview", "home", new { id = item.ID })"><img src="~/images/GreenCircle.png" width="18" height="18"></a>
                                        }
                                    }
                                }
                            }
                        </td>
                    </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="14" class="text-center" align="center">No Records Found.</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
 
</div>

<br />
<br />
<script>
    $(document).ready(function () {

        $('#tblPatientDetails').DataTable({
            "searching": true,
            "ordering": true,
            "paging": true,
            "pageLength": 20,
            "lengthMenu": [
            [ 10, 20, 50, 100, -1 ],
            ['10 rows', '20 rows', '50 rows', '100 rows', 'Show all']],
        });
    });
</script>

<script type="text/javascript">
$(function () {
    $("#btnSearch").click(function(){
window.location.href = "@Url.Action("MedicalExaminerDashboard", "Home")";
    });


});
</script>


